<!DOCTYPE html>
<html lang="en">
	<head>
		<title>SOSA Create Stimulus</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #f0f0f0;
				margin: 0px;
				overflow: hidden;
			}
		</style>
		<!--
		Basic layout from
		http://mrdoob.github.io/three.js/examples/canvas_geometry_board.html
		Image Upload basics from
		http://zhangwenli.com/blog/2015/05/29/upload-images-with-dat-gui/
		-->
	</head>
	
	<body>
		<script src="js/three.js"></script>	
		<script src="js/Mirror.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/stats.js"></script>	
		<script src="js/DAT.GUI.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/CanvasRenderer.js"></script>
		
		<input id="img-path" type="file" style="display: none;" />

		
		<script>

			var container, stats;
			var camera, scene, renderer;
			var stim;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			
			//Scene setup 
			function init() {
				
				container = document.createElement( 'div' );
				document.body.appendChild( container );

				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.style.color = '#ffffff';
				info.innerHTML = 'Create Stimulus';
				container.appendChild( info );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.y = 150;
				camera.position.z = 500;

				scene = new THREE.Scene();

				//stim
				var geometry = new THREE.BoxGeometry( 50, 50, 50 );
				for ( var i = 0; i < geometry.faces.length; i += 2 ) {
					var colo =  "rgb(255, 255, 255)";
					geometry.faces[ i ].color.set(new THREE.Color(colo));
					geometry.faces[ i + 1 ].color.set(new THREE.Color(colo));
				}
				var material = new THREE.MeshBasicMaterial( { vertexColors: THREE.FaceColors, overdraw: 0.5 } );
				stim = new THREE.Mesh( geometry, material );
				stim.position.y = 200;
				stim.rotation.x = .5;
				scene.add( stim );

				//Renderer
				renderer = new THREE.CanvasRenderer();
				renderer.setClearColor( 0x000000 );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				//Stats
				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

				//Resize event listener
				window.addEventListener( 'resize', onWindowResize, false );
				

			}
			
			//MAKE THIS SCALE SHIT
			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			//
			function animate() {
				requestAnimationFrame( animate );
				stats.begin();
				render();
				stats.end();
			}

			function render() {
				renderer.render( scene, camera );
			}

			//Start GUI
			//GUI params
			/*
			*
			*	To add items to the GUI
			*	First add to the controls var
			*	Then add it to the gui in the gui creation section
			*	Then add onClick/onChange functionality as desired
			*
			*/
			
			var controls = function() {
			
				this.stimName = 'stimName';
				this.stimLabel = 'stimLabel';

				this.rotationX = 1;

				this.bgR = 255;
				this.bgG = 255;
				this.bgB = 255;
				
				this.stimR = 255;
				this.stimG = 255;
				this.stimB = 255;
				
				this.sizeX = 1;
				this.sizeY = 1;
				this.sizeZ = 1;
				
				this.imageName = '';
				this.uploadImage = function() {
				

					var input = document.getElementById('img-path');
					input.addEventListener('change', function() {
						var file = input.files[0];
						stimTest.imageName = file.name;
					});
					input.click();
				};
				
				this.finish = function(){
					alert("Code this to pump out a json file");
				};

			};

			//GUI creation		
			/*
			*	listen() on the gui panels allows the gui to react to outside input i.e. setDefault etc
			*	onChange() updates the scene based off gui values
			*
			*
			*	An Example addition to the gui
			*
			*	scale.add(stimTest, ).listen().onChange( function(){
			*	});
			*/
						
			//vars for rgb color strings
			var stimColor;
			var bgColor;
			
			//The variables object for the gui
			var stimTest = new controls();
			
			//The gui object
			var gui = new dat.GUI();

			//all gui functionality
			var rotate = gui.addFolder('Rotate');
			rotate.open();
			rotate.add(stimTest, 'rotationX', -3.14, 3.14).listen().onChange( function(){
				stim.rotation.x = (stimTest.rotationX);
			});
			
			var backgroundAppearance = gui.addFolder('Background');
			backgroundAppearance.open();
			backgroundAppearance.add(stimTest, 'bgR', 0, 255).listen().onChange( function(){
				bgColor = "rgb("+Math.round(stimTest.bgR)+", "+Math.round(stimTest.bgG)+", "+Math.round(stimTest.bgB)+")";
				renderer.setClearColor(new THREE.Color(bgColor));
			});
			backgroundAppearance.add(stimTest, 'bgG', 0, 255).listen().onChange( function(){
				bgColor = "rgb("+Math.round(stimTest.bgR)+", "+Math.round(stimTest.bgG)+", "+Math.round(stimTest.bgB)+")";
				renderer.setClearColor(new THREE.Color(bgColor));
			});
			backgroundAppearance.add(stimTest, 'bgB', 0, 255).listen().onChange( function(){
				bgColor = "rgb("+Math.round(stimTest.bgR)+", "+Math.round(stimTest.bgG)+", "+Math.round(stimTest.bgB)+")";
				renderer.setClearColor(new THREE.Color(bgColor));
			});
			
			var color = gui.addFolder('Color');
			color.open();
			color.add(stimTest, 'stimR', 0, 255).listen().onChange( function(){
					stimColor = "rgb("+Math.round(stimTest.stimR)+", "+Math.round(stimTest.stimG)+", "+Math.round(stimTest.stimB)+")";
					stim.material.color.set(new THREE.Color(stimColor));
			});
			color.add(stimTest, 'stimG', 0, 255).listen().onChange( function(){
				stimColor = "rgb("+Math.round(stimTest.stimR)+", "+Math.round(stimTest.stimG)+", "+Math.round(stimTest.stimB)+")";
				stim.material.color.set(new THREE.Color(stimColor));
			});
			color.add(stimTest, 'stimB', 0, 255).listen().onChange( function(){
				stimColor = "rgb("+Math.round(stimTest.stimR)+", "+Math.round(stimTest.stimG)+", "+Math.round(stimTest.stimB)+")";
				stim.material.color.set(new THREE.Color(stimColor));
			});
			
			var size = gui.addFolder('Size');
			size.open();
			size.add(stimTest, 'sizeX', 1, 3).step(.01).listen().onChange( function(){
				stim.scale.x = stimTest.sizeX;
				stim.scale.y = stimTest.sizeY;
				stim.scale.z = stimTest.sizeZ;
				
			});
			size.add(stimTest, 'sizeY', 1, 3).step(.01).listen().onChange( function(){
				stim.scale.x = stimTest.sizeX;
				stim.scale.y = stimTest.sizeY;
				stim.scale.z = stimTest.sizeZ;
			
			});
			size.add(stimTest, 'sizeZ', 1, 3).step(.01).listen().onChange( function(){
				stim.scale.x = stimTest.sizeX;
				stim.scale.y = stimTest.sizeY;
				stim.scale.z = stimTest.sizeZ;
			
			});

			var image = gui.addFolder('Image');
			image.open();
			image.add(stimTest, 'imageName', stimTest.imageName).listen();
			image.add(stimTest, 'uploadImage');
			
			var finish = gui.addFolder('Finish');
			finish.open();
			finish.add(stimTest, 'finish');

			init();
			animate();
			//END GUI
		</script>

	</body>
</html>
