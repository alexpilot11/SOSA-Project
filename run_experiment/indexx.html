<!DOCTYPE html>
<html lang="en">
<head>
    <title>SOSA Preview Experiment</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #f0f0f0;
            margin: 0px;
            overflow: hidden;
        }
    </style>
    <!--
    Basic layout from
    http://mrdoob.github.io/three.js/examples/canvas_geometry_board.html
    -->


</head>
<body>
<script src="js/three.js"></script>
<script src="js/Mirror.js"></script>
<script src="js/OrbitControls.js"></script>
<script src="js/Detector.js"></script>
<script src="js/DAT.GUI.js"></script>
<script src="js/Projector.js"></script>
<script src="js/CanvasRenderer.js"></script>

<script src="js/TrackballControls.js"></script>


<script>

    var container;

    var camera, scene, renderer;

    var board;
    /*
     = 	{
     boardR: 255,
     boardG: 255,
     boardB: 255,
     boardTiltDefaults: true,
     tiltSet: function(){},
     boardDefaults: true

     this.bgR = 255;
     this.bgG = 255;
     this.bgB = 255;
     this.backgroundDefaults = true;
     this.hasBG = true;

     this.import = function(){};
     this.export = function(){};

     this.showLabels = true;
     this.labelPosition = 60;
     this.labelShade = 100;
     this.labelSize = 75;
     this.labelDefaults = true;

     this.outputLoc = function(){};

     }	*/


    var targetRotation = -350;
    var targetRotationOnMouseDown = 0;

    var mouseX = 0;
    var mouseXOnMouseDown = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;


    var boardR, boardG, boardB, boardDefaults, boardTiltDefault, bgR, bgG, bgB, backgroundDefaults, hasBG, showLables,
            labelPosition, labelShade, labelSize, labelDefaults;

    init();
    animate();

    function init() {
        container = document.createElement('div');
        document.body.appendChild(container);

        var info = document.createElement('div');
        info.style.position = 'absolute';
        info.style.top = '10px';
        info.style.width = '100%';
        info.style.textAlign = 'center';
        info.innerHTML = 'Preview Experiment';
        container.appendChild(info);

        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.y = 150;
        camera.position.z = 500;

        scene = new THREE.Scene();

        // board

        var geometry = new THREE.BoxGeometry(400, 20, 400);

        for (var i = 0; i < geometry.faces.length; i += 2) {

            var hex = 0xffffff;
            geometry.faces[i].color.setHex(hex);
            geometry.faces[i + 1].color.setHex(hex);

        }

        var material = new THREE.MeshBasicMaterial({vertexColors: THREE.FaceColors, overdraw: 0.5});

        board = new THREE.Mesh(geometry, material);
        board.position.y = 200;
        board.rotation.x = -350.25;
        scene.add(board);

        renderer = new THREE.CanvasRenderer();
        renderer.setClearColor(0xf0f0f0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);


        document.addEventListener('mousedown', onDocumentMouseDown, false);
        document.addEventListener('touchstart', onDocumentTouchStart, false);
        document.addEventListener('touchmove', onDocumentTouchMove, false);

        //

        window.addEventListener('resize', onWindowResize, false);


        var stim = new THREE.BoxGeometry( 40, 40, 40 );
        var object = new THREE.Mesh(stim, new THREE.MeshLambertMaterial({ color: 0x0000ff }));
        object.position.x = 0;
        object.position.y = 0;
        object.position.z = 0;
        object.rotation.x = 350;
        object.rotation.y = 0;
        object.rotation.z = 0;
        scene.add(object);
        scene.add( new THREE.AmbientLight( 0x505050 ) );


    }

    function onWindowResize() {

        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

    }

    //

    function onDocumentMouseDown(event) {

        event.preventDefault();

        document.addEventListener('mousemove', onDocumentMouseMove, false);
        document.addEventListener('mouseup', onDocumentMouseUp, false);
        document.addEventListener('mouseout', onDocumentMouseOut, false);

        mouseXOnMouseDown = event.clientX - windowHalfX;
        targetRotationOnMouseDown = targetRotation;

    }

    function onDocumentMouseMove(event) {

        mouseX = event.clientX - windowHalfX;

        targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.02;

    }

    function onDocumentMouseUp(event) {

        document.removeEventListener('mousemove', onDocumentMouseMove, false);
        document.removeEventListener('mouseup', onDocumentMouseUp, false);
        document.removeEventListener('mouseout', onDocumentMouseOut, false);

    }

    function onDocumentMouseOut(event) {

        document.removeEventListener('mousemove', onDocumentMouseMove, false);
        document.removeEventListener('mouseup', onDocumentMouseUp, false);
        document.removeEventListener('mouseout', onDocumentMouseOut, false);

    }

    function onDocumentTouchStart(event) {

        if (event.touches.length === 1) {

            event.preventDefault();

            mouseXOnMouseDown = event.touches[0].pageX - windowHalfX;
            targetRotationOnMouseDown = targetRotation;

        }

    }

    function onDocumentTouchMove(event) {

        if (event.touches.length === 1) {

            event.preventDefault();

            mouseX = event.touches[0].pageX - windowHalfX;
            targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.05;

        }

    }

    //

    function animate() {

        requestAnimationFrame(animate);

        render();

    }

    function render() {
        //For rotation of the board
        board.rotation.x += ( targetRotation - board.rotation.x ) * 0.05;
        if (board.rotation.x >= -350.25) {
            //overhead
            board.rotation.x = -350.25;
        }
        else if (board.rotation.x <= -351.6) {
            //tilted all the way down
            board.rotation.x = -351.6;

        }
        renderer.render(scene, camera);

    }


    //Start GUI
    var board1 = function () {
        this.boardR = 255;
        this.boardG = 255;
        this.boardB = 255;
        this.boardTiltDefaults = true;
        this.tiltSet = function () {

        };
        this.boardDefaults = true;

        this.bgR = 255;
        this.bgG = 255;
        this.bgB = 255;
        this.backgroundDefaults = true;
        this.hasBG = true;

        this.import = function () {


        };
        this.export = function () {

            var properties = document.getElementsByClassName("property-name");

            var exportJSON = {};

            for (var i = 0; i < properties.length; i++) {

                if (properties[i].innerHTML == "boardR") {
                    exportJSON.boardR = properties[i].nextSibling.children[0].children[0].value;
                }
                else if (properties[i].innerHTML == "boardG") {
                    exportJSON.boardG = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "boardB") {
                    exportJSON.boardB = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "boardDefaults") {
                    exportJSON.boardDefaults = properties[i].nextSibling.children[0].value;

                }
                else if (properties[i].innerHTML == "boardTiltDefault") {
                    exportJSON.boardTiltDefault = properties[i].nextSibling.children[0].value;

                }
                else if (properties[i].innerHTML == "bgR") {
                    exportJSON.bgR = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "bgG") {
                    exportJSON.bgG = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "bgB") {
                    exportJSON.bgB = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "backgroundDefaults") {
                    exportJSON.backgroundDefaults = properties[i].nextSibling.children[0].value;

                }
                else if (properties[i].innerHTML == "hasBG") {
                    exportJSON.hasBG = properties[i].nextSibling.children[0].value;

                }
                else if (properties[i].innerHTML == "showLables") {
                    exportJSON.showLables = properties[i].nextSibling.children[0].value;

                }
                else if (properties[i].innerHTML == "labelPosition") {
                    exportJSON.labelPosition = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "labelShade") {
                    exportJSON.labelShade = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "labelSize") {
                    exportJSON.labelSize = properties[i].nextSibling.children[0].children[0].value;

                }
                else if (properties[i].innerHTML == "labelDefaults") {
                    exportJSON.labelDefaults = properties[i].nextSibling.children[0].value;

                }



            }
//            console.log(exportJSON);
            var textToSave = JSON.stringify(exportJSON);
            var hiddenElement = document.createElement('a');
            hiddenElement.href = 'data:attachment/text,' + encodeURI(textToSave);
            hiddenElement.target = '_blank';
            hiddenElement.download = 'myFile.txt';
            hiddenElement.click();

            //write to json and save

        };

        this.showLabels = true;
        this.labelPosition = 60;
        this.labelShade = 100;
        this.labelSize = 75;
        this.labelDefaults = true;

        this.outputLoc = function () {

        };

    };

    window.onload = function () {
        var boardTest = new board1();
        var gui = new dat.GUI();
//        gui.remember(boardTest);
        var appearance = gui.addFolder('Appearance');
        appearance.open();
        var boardAppearance = appearance.addFolder('Board1');
        boardAppearance.open();
        boardAppearance.add(boardTest, 'boardR', 0, 255);
        boardAppearance.add(boardTest, 'boardG', 0, 255);
        boardAppearance.add(boardTest, 'boardB', 0, 255);
        boardAppearance.add(boardTest, 'boardDefaults');
        boardAppearance.add(boardTest, 'tiltSet');
        boardAppearance.add(boardTest, 'boardTiltDefaults');


        var backgroundAppearance = appearance.addFolder('Background');
        backgroundAppearance.open();
        backgroundAppearance.add(boardTest, 'bgR', 0, 255);
        backgroundAppearance.add(boardTest, 'bgG', 0, 255);
        backgroundAppearance.add(boardTest, 'bgB', 0, 255);
        backgroundAppearance.add(boardTest, 'backgroundDefaults');
        backgroundAppearance.add(boardTest, 'hasBG');

        var settingsIO = gui.addFolder('Import/Export Settings');
        settingsIO.open();
        settingsIO.add(boardTest, 'import');
        settingsIO.add(boardTest, 'export');

        var labels = gui.addFolder('Labels');
        labels.open();
        labels.add(boardTest, 'showLabels');
        labels.add(boardTest, 'labelPosition', 0, 100);
        labels.add(boardTest, 'labelShade', 0, 100);
        labels.add(boardTest, 'labelSize', 0, 100);
        labels.add(boardTest, 'labelDefaults');


        var outputLocation = gui.addFolder('Log Output Location');
        outputLocation.open();
        outputLocation.add(boardTest, 'outputLoc');


    };
    //END GUI
</script>

</body>
</html>
